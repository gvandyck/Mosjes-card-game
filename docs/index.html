<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MOSJES - Local MVP</title>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ´</text></svg>">
    <link rel="stylesheet" href="style_v3.css">
    <link rel="stylesheet" href="style_animation.css">
    <link rel="stylesheet" href="mosje_style.css">
</head>

<body>
    <!-- Firebase Config (Hidden) -->
    <div style="display:none">
        <input id="apiKey" value="AIzaSyCAGazLyW_o3PNLy4tF8jccqdqd49tn9zk" />
        <input id="projectId" value="mosjes-card-game"/>
        <input id="databaseUrl" value="https://mosjes-card-game-default-rtdb.firebaseio.com/"/>
    </div>

    <!-- Combined Setup Modal -->
    <div id="setupModal" class="modal" style="display:flex">
        <div class="card" style="width:90%; max-width:800px">
            <h2 style="color:var(--accent);margin:0 0 20px 0; text-align:center">Mosjes Card Game</h2>
            
            <div style="display:flex; gap:30px; flex-wrap:wrap;">
                <!-- Left: Deck Selection -->
                <div style="flex:1; min-width:280px;">
                    <h3 style="margin-bottom:15px; color:#ddd;">1. Choose Your Deck</h3>
                    <div class="deck-options" style="display:flex; flex-direction:column; gap:10px;">
                        <div class="deck-option selected" onclick="selectDeckUI(0, this)" style="border:2px solid var(--accent); padding:12px; cursor:pointer; border-radius:8px; background:rgba(255,255,255,0.05); transition:all 0.2s;">
                            <div style="font-weight:bold; color:#ff6b6b">Physical Force</div>
                            <div class="smallMuted">Aggressive, High MP, Strong Attacks</div>
                        </div>
                        <div class="deck-option" onclick="selectDeckUI(1, this)" style="border:1px solid #444; padding:12px; cursor:pointer; border-radius:8px; background:rgba(255,255,255,0.05); transition:all 0.2s;">
                            <div style="font-weight:bold; color:#4ecdc4">Digital Control</div>
                            <div class="smallMuted">Tactical, Card Advantage, Manipulation</div>
                        </div>
                        <div class="deck-option" onclick="selectDeckUI(2, this)" style="border:1px solid #444; padding:12px; cursor:pointer; border-radius:8px; background:rgba(255,255,255,0.05); transition:all 0.2s;">
                            <div style="font-weight:bold; color:#c44569">Artistic Rhythm</div>
                            <div class="smallMuted">Combo, Rerolls, High Variance</div>
                        </div>
                    </div>
                    <input type="hidden" id="selectedDeckIndex" value="0">
                </div>

                <!-- Right: Room Actions -->
                <div style="flex:1; min-width:280px; border-left:1px solid #333; padding-left:30px;">
                    <h3 style="margin-bottom:15px; color:#ddd;">2. Start Game</h3>
                    
                    <div style="margin-bottom:30px;">
                        <button class="btn" onclick="handleCreateRoom()" style="width:100%; padding:16px; font-size:1.1em; background:var(--accent); color:white; font-weight:bold; border:none; box-shadow:0 4px 12px rgba(230, 126, 34, 0.3);">Create Room</button>
                        <div class="smallMuted" style="margin-top:8px; text-align:center;">You will be Player 1</div>
                    </div>

                    <div style="border-top:1px solid #333; padding-top:20px;">
                        <div style="display:flex; gap:10px;">
                            <input id="joinCode" class="input" placeholder="Enter Room Code" type="number" inputmode="numeric" style="flex:1;" />
                            <button class="btn" onclick="handleJoinRoom()" style="background:#555; color:#eee;">Join</button>
                        </div>
                        <div class="smallMuted" style="margin-top:8px; text-align:center;">You will be Player 2</div>
                        <div id="roomHint" class="smallMuted" style="color:var(--bad); margin-top:10px; min-height:20px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function selectDeckUI(index, el) {
            document.getElementById('selectedDeckIndex').value = index;
            // Update UI
            document.querySelectorAll('.deck-option').forEach(opt => {
                opt.style.border = '1px solid #444';
                opt.classList.remove('selected');
            });
            el.style.border = '2px solid var(--accent)';
            el.classList.add('selected');
        }
    </script>

    <div class="topbar">
        <div style="display:flex;align-items:center;gap:16px;width:100%;">
            <strong>Room:</strong> <span id="roomCode">--</span>
            <div id="statusText">Not connected</div>

            <div style="margin-left:auto; display:flex; align-items:center; gap:16px;">
                <strong>Phase:</strong> <span id="phaseIndicator">Draw</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="battlefield">
            <!-- Left: Shared Place -->
            <div class="side-zone">
                <div class="area" style="display:flex;flex-direction:column;align-items:center;">
                    <div style="font-weight:700;margin-bottom:8px;">Shared Place</div>
                    <div class="questCard" id="sharedPlace">No Place</div>
                </div>
                
                <!-- Log (Moved here) -->
                <div class="area" style="margin-top:16px; padding: 10px; width: 100%; max-width: 100%;">
                    <div style="display:flex; justify-content:space-between; align-items:center; cursor:pointer; user-select:none;" onclick="toggleLog()">
                        <div style="font-weight:700; font-size:14px;">Game Log</div>
                        <div id="logToggleIcon" style="font-size:12px; color:#888;">â–¼</div>
                    </div>
                    <div class="log" id="log" style="margin-top:10px; height:100px; display:none;"></div>
                </div>
            </div>

            <!-- Center: Play Area -->
            <div class="play-zone">
                <!-- Opponent Field -->
                <div class="area" id="oppArea" style="margin-bottom: 24px;">
                    <div class="flex" style="justify-content:space-between">
                        <div><strong>Opponent</strong> <span style="color:var(--accent); margin-left:10px;">MP: <span id="oppTotalMp">0</span></span></div>
                    </div>
                    <div style="display:flex;gap:16px;margin-top:8px;align-items:flex-start;justify-content:center;flex-wrap:wrap;">
                        <div id="oppMosjes" style="display:flex; gap: 8px; flex-wrap: wrap; justify-content: center;"></div>
                        <div class="pieSlots" id="oppPiecies"></div>
                        <div class="smallMuted" style="width:100%;text-align:center;margin-top:4px">Piecies: <span id="oppPieciesCount">0</span></div>
                    </div>
                </div>

                <!-- My Field -->
                <div class="area" id="myArea" style="width:100%;margin-top:0;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom:none; box-shadow: none;">
                    <div class="flex" style="justify-content:space-between">
                        <div><strong>You</strong> <span style="color:var(--accent); margin-left:10px;">MP: <span id="myTotalMp">0</span></span></div>
                        <div class="smallMuted">Hand: <span id="myHandCount">0</span></div>
                    </div>
                    <div style="display:flex;gap:16px;margin-top:8px;align-items:flex-start;justify-content:flex-start;flex-wrap:wrap;">
                        <div id="myMosjes" style="display:flex; gap: 8px; flex-wrap: wrap; justify-content: flex-start;"></div>
                        <div class="pieSlots" id="myPiecies"></div>
                    </div>
                    <div style="margin-top:8px;text-align:left;">
                        <div class="smallMuted">Drag cards here to place them</div>
                    </div>
                </div>

                <!-- My Hand (attached to bottom of My Field) -->
                <div class="area" style="margin-top:0;border-top-left-radius:0;border-top-right-radius:0;border-top:none; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div id="handLabel"><strong>Your Hand</strong></div>
                        <div class="smallMuted">
                            <button onclick="showDeck()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:2px 6px; border-radius:4px; font-size:12px;">Deck: <span id="myDeckCount">0</span></button>
                            <button onclick="showGraveyard()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:2px 6px; border-radius:4px; font-size:12px; margin-left:5px;">Discard: <span id="myDiscard">0</span></button>
                        </div>
                    </div>
                    <div class="hand" id="handArea" style="margin-top:8px"></div>
                    <div style="margin-top:8px;display:flex;gap:8px">
                        <button class="btn" id="drawBtn" onclick="drawCard()">Draw</button>
                        <button id="progressPhaseBtn" class="btn" onclick="progressPhase()">Start/End Turn</button>
                    </div>
                </div>
            </div>

            <!-- Right: Quest Deck -->
            <div class="side-zone">
                <div class="area" style="display:flex;flex-direction:column;align-items:center;">
                    <div style="font-weight:700;margin-bottom:8px;">Quest Deck</div>
                    <div class="questCard" id="activeQuest">No active quest</div>
                    <div style="margin-top:12px;">
                        <button class="btn" id="questBtn" onclick="drawAndAttemptQuest()">Attempt Quest</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleLog() {
            const log = document.getElementById('log');
            const icon = document.getElementById('logToggleIcon');
            if (log.style.display === 'none') {
                log.style.display = 'block';
                icon.textContent = 'â–²';
            } else {
                log.style.display = 'none';
                icon.textContent = 'â–¼';
            }
        }
    </script>

    <script src="advanced_logic.js?v=14"></script>
    <script src="script.js?v=14"></script>
</body>

</html>